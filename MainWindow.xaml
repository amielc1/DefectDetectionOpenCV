<Window x:Class="NdtImageProcessor.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="NDT Defect Detector" Height="700" Width="1000" Background="#333">
    
    <Grid Margin="10">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="250"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="150"/>
        </Grid.RowDefinitions>

        <StackPanel Grid.Column="0" Grid.RowSpan="2" Margin="0,0,10,0">
            <Button Content="📂 Load Image" Click="BtnLoad_Click" Height="40" Margin="0,0,0,10" Background="#555" Foreground="White"/>
            
            <GroupBox Header="LUT Colors (Segmentation)" Foreground="White">
                <StackPanel Margin="5">
                    <Label Content="Low Range (0 to C1):" Foreground="White"/>
                    <ComboBox Name="ComboColorLow" SelectionChanged="OnLutChanged" SelectedIndex="0">
                        <ComboBoxItem Content="Black (Background)"/>
                        <ComboBoxItem Content="Red (Defect)"/>
                        <ComboBoxItem Content="Green (Material)"/>
                    </ComboBox>
                    
                    <Label Content="Mid Range (C1 to C2):" Foreground="White"/>
                    <ComboBox Name="ComboColorMid" SelectionChanged="OnLutChanged" SelectedIndex="1">
                         <ComboBoxItem Content="Black (Background)"/>
                        <ComboBoxItem Content="Red (Defect)"/>
                        <ComboBoxItem Content="Green (Material)"/>
                    </ComboBox>

                    <Label Content="High Range (C2 to 255):" Foreground="White"/>
                    <ComboBox Name="ComboColorHigh" SelectionChanged="OnLutChanged" SelectedIndex="2">
                         <ComboBoxItem Content="Black (Background)"/>
                        <ComboBoxItem Content="Red (Defect)"/>
                        <ComboBoxItem Content="Green (Material)"/>
                    </ComboBox>
                </StackPanel>
            </GroupBox>

            <Button Content="🛠 Manual Step-by-Step" Click="BtnManualAnalyze_Click" Height="40" Margin="0,10,0,0" Background="#555" Foreground="White"/>
            <Button Content="🔍 Analyze Defects (Red Zones)" Click="BtnAnalyze_Click" Height="50" Margin="0,10,0,10" Background="#D32F2F" Foreground="White" FontWeight="Bold"/>

            <Label Content="Defects Found:" Foreground="White"/>
            <ListView Name="ListDefects" Height="300" Background="#222" Foreground="White">
                <ListView.View>
                    <GridView>
                        <GridViewColumn Header="ID" DisplayMemberBinding="{Binding Id}" Width="40"/>
                        <GridViewColumn Header="Area (px)" DisplayMemberBinding="{Binding Area}" Width="80"/>
                        <GridViewColumn Header="Status" DisplayMemberBinding="{Binding Status}" Width="80"/>
                    </GridView>
                </ListView.View>
            </ListView>
        </StackPanel>

        <Border Grid.Column="1" Grid.Row="0" BorderBrush="#555" BorderThickness="1" Background="Black">
            <ScrollViewer Name="ImageScrollViewer" HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
                <Image Name="ImgDisplay" Stretch="Uniform" MouseWheel="ImgDisplay_MouseWheel">
                    <Image.LayoutTransform>
                        <ScaleTransform x:Name="ImageScaleTransform" ScaleX="1" ScaleY="1"/>
                    </Image.LayoutTransform>
                </Image>
            </ScrollViewer>
        </Border>

        <Grid Grid.Column="1" Grid.Row="1" Margin="0,10,0,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            
            <Canvas Name="HistCanvas" Background="#111" SizeChanged="HistCanvas_SizeChanged"/>
            
            <Grid VerticalAlignment="Center" Height="30">
                <Slider Name="SliderLow" Minimum="0" Maximum="255" Value="80" 
                        ValueChanged="OnSliderChanged" Opacity="0.7" Foreground="Cyan"/>
            </Grid>
            <Grid VerticalAlignment="Bottom" Height="30" Margin="0,0,0,-15">
                <Slider Name="SliderHigh" Minimum="0" Maximum="255" Value="180" 
                        ValueChanged="OnSliderChanged" Opacity="0.7" Foreground="Yellow"/>
            </Grid>
            
            <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Center">
                <TextBlock Text="Cursor 1: " Foreground="Cyan"/>
                <TextBlock Text="{Binding ElementName=SliderLow, Path=Value, StringFormat=N0}" Foreground="Cyan" Margin="0,0,20,0"/>
                <TextBlock Text="Cursor 2: " Foreground="Yellow"/>
                <TextBlock Text="{Binding ElementName=SliderHigh, Path=Value, StringFormat=N0}" Foreground="Yellow"/>
            </StackPanel>
        </Grid>
    </Grid>
</Window>